(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["FormAdd"],{"008c":function(t,e,i){},"067b":function(t,e,i){},"2d75":function(t,e,i){"use strict";var n=i("067b"),a=i.n(n);a.a},"3e88":function(t,e,i){},"56f5":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("a-card",{attrs:{bordered:!1}},[i("div",{staticClass:"progress-part"},[i("a-button",{staticClass:"top-back-btn",attrs:{type:"primary"},on:{click:t.showTest}},[i("a-icon",{attrs:{type:"left"}})],1),i("a-steps",{attrs:{current:t.currentIndex,size:"small"}},[i("a-step",{attrs:{title:"基本信息"}}),i("a-step",{attrs:{title:"表单设计"}}),i("a-step",{attrs:{title:"列表设计"}})],1)],1),0===t.currentIndex?i("div",[i("a-spin",{attrs:{spinning:t.formLoading}},[i("a-form",{staticClass:"ant-form",attrs:{form:t.form,autocomplete:"off"},on:{submit:t.submitBaseInfo}},[i("a-form-item",{attrs:{label:"表单名称",labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:17}}}},[i("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,message:"请输入表单名称"},{min:1,max:20,message:"表单名称为1~20个字符"}],initialValue:t.baseInfo.title}],expression:"['title',\n                        {rules: [{ required: true, message: '请输入表单名称'},\n                        { min: 1, max: 20, message: '表单名称为1~20个字符'}],initialValue:\n                        baseInfo.title}]"}],attrs:{placeholder:"请输入，20个字以内"}})],1),i("a-form-item",{attrs:{label:"所属菜单",labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:17}}}},[i("MenuTree",{directives:[{name:"decorator",rawName:"v-decorator",value:["mid",{initialValue:t.pInfo.id,rules:[{required:!0,message:"请选择所属菜单"}]}],expression:"[\n                        'mid',\n                        {\n                            initialValue: pInfo.id,\n                            rules: [{ required: true, message: '请选择所属菜单' }]\n                        }\n                    ]"}],attrs:{treeData:t.menuList,nodeLevel:0,nodeInfo:t.pInfo,placeholder:"请选择所属菜单"},on:{nodeClick:t.getPreMenu}})],1),i("a-form-item",{attrs:{label:"是否启用",labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:17}}}},[i("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["status",{valuePropName:"checked",initialValue:t.baseInfo.status}],expression:"['status', {valuePropName: 'checked', initialValue: baseInfo.status}]"}],on:{change:t.infoSwitchChange}}),t._v(t._s(t.infoSwitchVal)+"\n                    ")],1),i("p",{staticClass:"tac"},[t._v("一个菜单下只能有一个启用状态的表单，如所选菜单中已有启用状态的表单，建议先停用该表单")]),i("a-form-item",{attrs:{"wrapper-col":{span:12,offset:5}}},[i("a-button",{attrs:{type:"primary","html-type":"submit"}},[t._v("\n                            下一步\n                        ")])],1)],1)],1)],1):1===t.currentIndex?i("div",[i("fm-making-form",{ref:"makingform",staticStyle:{height:"500px"},attrs:{preview:""}}),i("a-button",{staticClass:"mt20 mr20",attrs:{type:"primary"},on:{click:function(e){return t.toPrev(0)}}},[t._v("上一步")]),i("a-button",{staticClass:"mt20",attrs:{type:"primary"},on:{click:t.getjson}},[t._v("下一步")])],1):t._e(),2===t.currentIndex?i("div",[i("a-spin",{attrs:{spinning:t.submitLoading}},[i("a-table",{ref:"table",attrs:{loading:t.tableLoading,size:"default",rowKey:"key",columns:t.listColumns,dataSource:t.listTableData,pagination:!1},scopedSlots:t._u([{key:"isInList",fn:function(e,n){return i("a-checkbox",{attrs:{checked:!0===n.isInList},on:{change:function(e){return t.changeTableShow(n)}}})}},{key:"isSearch",fn:function(e,n){return i("a-checkbox",{attrs:{checked:!0===n.isSearch},on:{change:function(e){return t.changeTableSearch(n)}}})}},{key:"sort",fn:function(e,n){return i("input",{directives:[{name:"model",rawName:"v-model",value:n.sort,expression:"record.sort"}],staticClass:"table-input",domProps:{value:n.sort},on:{change:function(e){return t.listTableSortChange(e,n)},input:function(e){e.target.composing||t.$set(n,"sort",e.target.value)}}})}}],null,!1,1113246302)}),i("a-button",{staticClass:"mt20 mr20",attrs:{type:"primary"},on:{click:function(e){return t.toPrev(1)}}},[t._v("上一步")]),i("a-button",{staticClass:"mt20",attrs:{type:"primary"},on:{click:t.submitAllForm}},[t._v("发布")])],1)],1):t._e()])],1)},a=[],s=i("bd86"),o=(i("c5f6"),i("7f7f"),i("6762"),i("2fdb"),i("ac6a"),i("456d"),i("cebc")),r=i("a49e"),l=i("e2a5"),c=i("2971"),d=i("2f62"),f="designCenter",u={name:"addForm",components:{MenuTree:l["a"]},data:function(){return{pageType:"add",currentIndex:0,submitLoading:!1,form:this.$form.createForm(this),formLoading:!1,pInfo:{},infoSwitchVal:"启用",menuList:[],baseInfo:{title:"",mid:"",status:!0},editTitleOriginal:"",midOriginal:"",statusOriginal:"",configObj:{},listColumns:[{title:"字段名称",dataIndex:"name",align:"center"},{title:"是否在列表显示",dataIndex:"isInList",scopedSlots:{customRender:"isInList"},align:"center"},{title:"可否搜索",dataIndex:"isSearch",scopedSlots:{customRender:"isSearch"},align:"center"},{title:"在列表中的排序(数字越大，排在列表的越前面)",dataIndex:"sort",scopedSlots:{customRender:"sort"},align:"center"}],tableLoading:!1,listTableData:[]}},computed:Object(o["a"])({},Object(d["e"])(f,["isFormAddSuccess"])),watch:{currentIndex:function(t,e){var i=this;1===t&&this.configObj.list&&this.configObj.list.length&&this.$nextTick(function(){i.setjson()})},"baseInfo.status":function(t){this.infoSwitchVal=t?"启用":"停用"},isFormAddSuccess:function(t){var e=this;if(t&&this.isFormAddSuccess){this.configObj=JSON.parse(JSON.stringify(this.$refs.makingform.getJSON()));var i=Object.keys(this.configObj);if(i.length)if(this.configObj.list&&!this.configObj.list.length)this.$message.warning("表单字段不可为空");else{for(var n=!0,a="",s="",o=0;o<this.configObj.list.length;o++){if(this.configObj.list[o].model.includes("select")){var r=this.configObj.list[o].options.options.map(function(t){return t.value});if(this.configObj.list[o].options.multiple){if(this.configObj.list[o].options.defaultValue.length||!r.includes(this.configObj.list[o].options.defaultValue[0])){n=!1,a=this.configObj.list[o].name;break}}else if(""!==this.configObj.list[o].options.defaultValue&&!r.includes(this.configObj.list[o].options.defaultValue)){n=!1,a=this.configObj.list[o].name;break}}else if(this.configObj.list[o].model.includes("imgupload")&&this.configObj.list[o].options.min>Number(this.configObj.list[o].options.maxlength)){n=!1,s=this.configObj.list[o].name;break}if(1===this.configObj.list[o].options.defaultType)if(this.configObj.list[o].linkage_config){var l=Object.keys(this.configObj.list[o].linkage_config);l.length||(this.configObj.list[o].options.defaultType=0,delete this.configObj.list[o].linkage_config)}else this.configObj.list[o].options.defaultType=0}if(!n){if(a)return void this.$message.warning('"'.concat(a,'"该项的默认值与选项不匹配，请删除该项重试'));if(s)return void this.$message.warning('"'.concat(s,'"最大上传数不得小于最小值'))}this.listTableData=[],this.configObj.list.forEach(function(t){t.hasOwnProperty("isInList")||Object.assign(t,{isInList:!1}),t.hasOwnProperty("isSearch")||Object.assign(t,{isSearch:!1}),t.hasOwnProperty("sort")||Object.assign(t,{sort:""}),e.listTableData.push(t)}),this.currentIndex=2}else this.$message.warning("表单字段不可为空")}}},created:function(){this.getMenuListAll(),this.getDefault()},methods:Object(o["a"])({},Object(d["d"])(f,["SET_TOFORMAddTHREE"]),{getDefault:function(){var t=this;this.$route.params.id&&(this.pageType="edit",this.formLoading=!0,Object(r["g"])({id:this.$route.params.id}).then(function(e){t.baseInfo.title=e.Data.title,t.editTitleOriginal=e.Data.title,t.baseInfo.mid=Number(e.Data.mid),t.midOriginal=Number(e.Data.mid),t.baseInfo.status=1===e.Data.status,t.statusOriginal=1===e.Data.status,t.configObj=JSON.parse(e.Data.form_config),t.listTableData=JSON.parse(e.Data.list_config),t.$set(t.pInfo,"id",e.Data.mid),t.$set(t.pInfo,"title",e.Data.mname),t.formLoading=!1}).catch(function(e){console.log(e),t.formLoading=!1}))},showTest:function(){var t=this;this.$confirm("离开后[未发布的内容]将不会保存，确认离开吗？","提示",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning"}).then(function(){t.handleModalOk()}).catch(function(){console.log("cancel")})},getMenuListAll:function(){var t=this,e={page:"",search:""};Object(r["i"])(e).then(function(e){t.menuList=Object(c["a"])(e.Data.lists)}).catch(function(t){console.log(t)})},getPreMenu:function(t){"/listtpl/getlist"==t.url?this.pInfo=t:this.$message.warning("只能选择内链的菜单")},infoSwitchChange:function(t){this.baseInfo.status=t},submitBaseInfo:function(t){var e=this;t.preventDefault(),this.form.validateFields(function(t,i){if(!t){e.formLoading=!0,e.baseInfo=i;var n={dataTag:1,dataId:"edit"===e.pageType?e.$route.params.id:0};"edit"===e.pageType&&e.editTitleOriginal===e.baseInfo.title&&e.statusOriginal===e.baseInfo.status&&e.midOriginal===Number(e.baseInfo.mid)?(e.formLoading=!1,e.currentIndex=1):(Object.assign(n,{fieldName:"title"},{fieldValue:e.baseInfo.title}),Object(r["b"])(n).then(function(t){if(0===t.Data)if(e.baseInfo.status){var i={mid:e.baseInfo.mid,status:!0===e.baseInfo.status?1:2,dataId:"edit"===e.pageType?e.$route.params.id:0};Object(r["c"])(i).then(function(t){0===t.Data?e.currentIndex=1:e.$message.error("该菜单下已有开启状态的表单"),e.formLoading=!1}).catch(function(t){console.log(t),e.formLoading=!1})}else e.currentIndex=1;else e.$message.error("该表单名称已存在"),e.formLoading=!1}).catch(function(t){console.log(t),e.formLoading=!1}))}})},setjson:function(){this.$refs.makingform.setJSON(this.configObj)},getjson:function(){this.SET_TOFORMAddTHREE(!0)},changeTableShow:function(t){var e=this;this.tableLoading=!0,t.isInList=!t.isInList,t.isInList||(t.isSearch=!1),setTimeout(function(){e.tableLoading=!1},16)},changeTableSearch:function(t){var e=this;if(this.tableLoading=!0,!t.isInList)return t.isSearch=!1,this.$message.warning("只有在列表中显示的字段才能被搜索"),void(this.tableLoading=!1);t.isSearch=!t.isSearch,setTimeout(function(){e.tableLoading=!1},100)},listTableSortChange:function(t,e){var i=Number(t.target.value);isNaN(i)?this.$message.error("排序请输入数字"):e.sort=i},submitAllForm:function(){var t=this;this.$confirm("确定要发布吗？","提示",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning"}).then(function(){t.submitLoading=!0;var e=[],i={},n=JSON.parse(JSON.stringify(t.listTableData));if(n.forEach(function(t){t.linkage_config&&(Object.assign(i,Object(s["a"])({},t.linkage_config.field3,{formid:t.linkage_config.formid,field1:t.linkage_config.field1,field2:t.linkage_config.field2,field3:t.linkage_config.field3,field4:t.linkage_config.field4})),delete t.linkage_config),t.isInList&&e.push(t)}),!e.length)return t.$message.warning("请至少选择一个或以上字段作为列表展示字段"),void(t.submitLoading=!1);t.configObj.list=JSON.parse(JSON.stringify(t.listTableData));var a={title:t.baseInfo.title,status:!0===t.baseInfo.status?1:2,form_config:JSON.stringify(t.configObj),list_config:JSON.stringify(e),linkage_config:JSON.stringify(i),menuid:2,mid:t.baseInfo.mid,id:"edit"===t.pageType?t.$route.params.id:0};Object(r["a"])(a).then(function(e){t.submitLoading=!1,t.$router.push("/designCenter/form-design/list")}).catch(function(e){console.log(e),t.submitLoading=!1})}).catch(function(){console.log("cancel")})},toPrev:function(t){this.currentIndex=t},handleModalOk:function(){this.$router.push("/designCenter/form-design/list")}})},g=u,h=(i("f3dd"),i("2877")),m=Object(h["a"])(g,n,a,!1,null,"4042b0da",null);e["default"]=m.exports},"889e":function(t,e,i){"use strict";var n=i("88a8"),a=i.n(n);a.a},"88a8":function(t,e,i){},e2a5:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tree"},[i("a-popover",{attrs:{placement:"rightTop",overlayClassName:"tree-popover"},on:{visibleChange:t.visibleChange}},[i("template",{slot:"content"},[t.treeData.length?t._e():i("div",{staticClass:"no-data"},[t._v("暂无数据")]),i("TreeNode",{attrs:{treeData:t.treeData,nodeLevel:t.nodeLevel,activeNodeId:t.activeNodeId},on:{nodeClick:t.nodeClick}})],1),i("a-input",{attrs:{placeholder:t.placeholderInner,readOnly:!0,value:t.title},on:{change:t.handleChange}},[i("a-icon",{style:{color:"#999"},attrs:{slot:"suffix",type:t.down?"down":"up"},slot:"suffix"})],1)],2)],1)},a=[],s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tree"},t._l(t.treeData,function(e,n){return i("div",{key:e.id},[i("div",{staticClass:"tree-item",class:{active:e.id==t.activeNodeId},style:t.style,attrs:{href:"javascript:;"},on:{click:function(i){return t.nodeClick(e)}}},[e.children?i("a-icon",{attrs:{type:t.openNode[n]?"caret-up":"caret-down"},on:{click:function(e){return e.stopPropagation(),t.visChildren(n)}}}):t._e(),t._v("\n            "+t._s(e.title)+"\n        ")],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.openNode[n],expression:"openNode[index]"}]},[e.children&&e.children.length?i("TreeNode",{attrs:{treeData:e.children,nodeLevel:t.nodeLevel+1,activeNodeId:t.activeNodeId},on:{nodeClick:t.nodeClick}}):t._e()],1)])}),0)},o=[],r=(i("6c7b"),{name:"TreeNode",props:["treeData","nodeLevel","activeNodeId"],data:function(){return{openNode:[]}},computed:{style:function(){return{paddingLeft:20*this.nodeLevel+"px"}}},watch:{treeData:{handler:function(){var t=new Array(this.treeData.length).fill(!0);this.$set(this,"openNode",t)},deep:!0}},mounted:function(){var t=new Array(this.treeData.length).fill(!0);this.$set(this,"openNode",t)},methods:{visChildren:function(t){var e=this.openNode[t];this.$set(this.openNode,t,!e)},nodeClick:function(t){this.$emit("nodeClick",t)}}}),l=r,c=(i("e898"),i("2877")),d=Object(c["a"])(l,s,o,!1,null,"15b7a835",null),f=d.exports,u={name:"MenuTree",components:{TreeNode:f},props:["treeData","nodeLevel","nodeInfo","placeholder"],data:function(){var t=this.nodeInfo;return{down:!1,title:t.title,activeNodeId:t.id}},computed:{placeholderInner:function(){return this.placeholder?this.placeholder:"请选择上级菜单"}},watch:{nodeInfo:function(t){this.title=t.title,this.activeNodeId=t.id,this.triggerChange(t.id)}},mounted:function(){this.title=this.nodeInfo.title,this.activeNodeId=this.nodeInfo.id},methods:{nodeClick:function(t){this.$emit("nodeClick",t)},visibleChange:function(t){this.down=!t,this.$emit("visibleHandle",t)},handleChange:function(t){this.triggerChange(this.nodeInfo.id)},triggerChange:function(t){this.$emit("change",t)}}},g=u,h=(i("889e"),i("2d75"),Object(c["a"])(g,n,a,!1,null,"a1e2e332",null));e["a"]=h.exports},e898:function(t,e,i){"use strict";var n=i("3e88"),a=i.n(n);a.a},f3dd:function(t,e,i){"use strict";var n=i("008c"),a=i.n(n);a.a}}]);