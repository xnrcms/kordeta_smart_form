(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["FormAdd"],{"067b":function(t,e,n){},"2d75":function(t,e,n){"use strict";var i=n("067b"),a=n.n(i);a.a},"3cae":function(t,e,n){"use strict";var i=n("a336"),a=n.n(i);a.a},"3e88":function(t,e,n){},"56f5":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("a-card",{attrs:{bordered:!1}},[n("div",{staticClass:"progress-part"},[n("a-button",{staticClass:"top-back-btn",attrs:{type:"primary"},on:{click:t.showTest}},[n("a-icon",{attrs:{type:"left"}})],1),n("a-steps",{attrs:{current:t.currentIndex,size:"small"}},[n("a-step",{attrs:{title:"基本信息"}}),n("a-step",{attrs:{title:"表单设计"}}),n("a-step",{attrs:{title:"列表设计"}})],1)],1),0===t.currentIndex?n("div",[n("a-spin",{attrs:{spinning:t.formLoading}},[n("a-form",{staticClass:"ant-form",attrs:{form:t.form,autocomplete:"off"},on:{submit:t.submitBaseInfo}},[n("a-form-item",{attrs:{label:"表单名称",labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:17}}}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,message:"请输入表单名称"},{min:1,max:20,message:"表单名称为1~20个字符"}],initialValue:t.baseInfo.title}],expression:"['title',\n                        {rules: [{ required: true, message: '请输入表单名称'},\n                        { min: 1, max: 20, message: '表单名称为1~20个字符'}],initialValue:\n                        baseInfo.title}]"}],attrs:{placeholder:"请输入，20个字以内"}})],1),n("a-form-item",{attrs:{label:"所属菜单",labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:17}}}},[n("MenuTree",{directives:[{name:"decorator",rawName:"v-decorator",value:["mid",{initialValue:t.pInfo.id,rules:[{required:!0,message:"请选择所属菜单"}]}],expression:"[\n                        'mid',\n                        {\n                            initialValue: pInfo.id,\n                            rules: [{ required: true, message: '请选择所属菜单' }]\n                        }\n                    ]"}],attrs:{treeData:t.menuList,nodeLevel:0,nodeInfo:t.pInfo,placeholder:"请选择所属菜单"},on:{nodeClick:t.getPreMenu}})],1),n("a-form-item",{attrs:{label:"是否启用",labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:10},sm:{span:17}}}},[n("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["status",{valuePropName:"checked",initialValue:t.baseInfo.status}],expression:"['status', {valuePropName: 'checked', initialValue: baseInfo.status}]"}],on:{change:t.infoSwitchChange}}),t._v(t._s(t.infoSwitchVal)+"\n                    ")],1),n("p",{staticClass:"tac"},[t._v("一个菜单下只能有一个启用状态的表单，如所选菜单中已有启用状态的表单，建议先停用该表单")]),n("a-form-item",{attrs:{"wrapper-col":{span:12,offset:5}}},[n("a-button",{attrs:{type:"primary","html-type":"submit"}},[t._v("\n                            下一步\n                        ")])],1)],1)],1)],1):1===t.currentIndex?n("div",[n("fm-making-form",{ref:"makingform",staticStyle:{height:"500px"},attrs:{preview:""}}),n("a-button",{staticClass:"mt20 mr20",attrs:{type:"primary"},on:{click:function(e){return t.toPrev(0)}}},[t._v("上一步")]),n("a-button",{staticClass:"mt20",attrs:{type:"primary"},on:{click:t.getjson}},[t._v("下一步")])],1):t._e(),2===t.currentIndex?n("div",[n("a-spin",{attrs:{spinning:t.submitLoading}},[n("a-table",{ref:"table",attrs:{loading:t.tableLoading,size:"default",rowKey:"key",columns:t.listColumns,dataSource:t.listTableData,pagination:!1},scopedSlots:t._u([{key:"isInList",fn:function(e,i){return n("a-checkbox",{attrs:{checked:!0===i.isInList},on:{change:function(e){return t.changeTableShow(i)}}})}},{key:"isSearch",fn:function(e,i){return n("a-checkbox",{attrs:{checked:!0===i.isSearch},on:{change:function(e){return t.changeTableSearch(i)}}})}},{key:"sort",fn:function(e,i){return n("input",{directives:[{name:"model",rawName:"v-model",value:i.sort,expression:"record.sort"}],staticClass:"table-input",domProps:{value:i.sort},on:{change:function(e){return t.listTableSortChange(e,i)},input:function(e){e.target.composing||t.$set(i,"sort",e.target.value)}}})}}],null,!1,1113246302)}),n("a-button",{staticClass:"mt20 mr20",attrs:{type:"primary"},on:{click:function(e){return t.toPrev(1)}}},[t._v("上一步")]),n("a-button",{staticClass:"mt20",attrs:{type:"primary"},on:{click:t.submitAllForm}},[t._v("发布")])],1)],1):t._e()])],1)},a=[],s=(n("7f7f"),n("6762"),n("2fdb"),n("ac6a"),n("456d"),n("c5f6"),n("a49e")),o=n("e2a5"),r=n("2971"),c={name:"addForm",components:{MenuTree:o["a"]},data:function(){return{pageType:"add",currentIndex:0,submitLoading:!1,form:this.$form.createForm(this),formLoading:!1,pInfo:{},infoSwitchVal:"启用",menuList:[],baseInfo:{title:"",mid:"",status:!0},editTitleOriginal:"",midOriginal:"",statusOriginal:"",configObj:{},listColumns:[{title:"字段名称",dataIndex:"name",align:"center"},{title:"是否在列表显示",dataIndex:"isInList",scopedSlots:{customRender:"isInList"},align:"center"},{title:"可否搜索",dataIndex:"isSearch",scopedSlots:{customRender:"isSearch"},align:"center"},{title:"在列表中的排序(数字越大，排在列表的越前面)",dataIndex:"sort",scopedSlots:{customRender:"sort"},align:"center"}],tableLoading:!1,listTableData:[]}},watch:{currentIndex:function(t,e){var n=this;1===t&&this.configObj.list&&this.configObj.list.length&&this.$nextTick(function(){n.setjson()})},"baseInfo.status":function(t){this.infoSwitchVal=t?"启用":"停用"}},created:function(){this.getMenuListAll(),this.getDefault()},methods:{getDefault:function(){var t=this;this.$route.params.id&&(this.pageType="edit",this.formLoading=!0,Object(s["g"])({id:this.$route.params.id}).then(function(e){t.baseInfo.title=e.Data.title,t.editTitleOriginal=e.Data.title,t.baseInfo.mid=Number(e.Data.mid),t.midOriginal=Number(e.Data.mid),t.baseInfo.status=1===e.Data.status,t.statusOriginal=1===e.Data.status,t.configObj=JSON.parse(e.Data.form_config),t.listTableData=JSON.parse(e.Data.list_config),t.$set(t.pInfo,"id",e.Data.mid),t.$set(t.pInfo,"title",e.Data.mname),t.formLoading=!1}).catch(function(e){console.log(e),t.formLoading=!1}))},showTest:function(){var t=this;this.$confirm("离开后[未发布的内容]将不会保存，确认离开吗？","提示",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning"}).then(function(){t.handleModalOk()}).catch(function(){console.log("cancel")})},getMenuListAll:function(){var t=this,e={page:"",search:""};Object(s["h"])(e).then(function(e){t.menuList=Object(r["a"])(e.Data.lists)}).catch(function(t){console.log(t)})},getPreMenu:function(t){console.log(t),"/listtpl/getlist"==t.url?this.pInfo=t:this.$message.warning("只能选择内链的菜单")},infoSwitchChange:function(t){this.baseInfo.status=t},submitBaseInfo:function(t){var e=this;t.preventDefault(),this.form.validateFields(function(t,n){if(!t){e.formLoading=!0,e.baseInfo=n;var i={dataTag:1,dataId:"edit"===e.pageType?e.$route.params.id:0};"edit"===e.pageType&&e.editTitleOriginal===e.baseInfo.title&&e.statusOriginal===e.baseInfo.status&&e.midOriginal===Number(e.baseInfo.mid)?(e.formLoading=!1,e.currentIndex=1):(Object.assign(i,{fieldName:"title"},{fieldValue:e.baseInfo.title}),Object(s["b"])(i).then(function(t){if(0===t.Data)if(e.baseInfo.status){var n={mid:e.baseInfo.mid,status:!0===e.baseInfo.status?1:2,dataId:"edit"===e.pageType?e.$route.params.id:0};Object(s["c"])(n).then(function(t){console.log(t),0===t.Data?e.currentIndex=1:e.$message.error("该菜单下已有开启状态的表单"),e.formLoading=!1}).catch(function(t){console.log(t),e.formLoading=!1})}else e.currentIndex=1;else e.$message.error("该表单名称已存在"),e.formLoading=!1}).catch(function(t){console.log(t),e.formLoading=!1}))}})},setjson:function(){this.$refs.makingform.setJSON(this.configObj)},getjson:function(){var t=this;this.configObj=JSON.parse(JSON.stringify(this.$refs.makingform.getJSON()));var e=Object.keys(this.configObj);if(e.length)if(this.configObj.list&&!this.configObj.list.length)this.$message.warning("表单字段不可为空");else{for(var n=!0,i="",a=0;a<this.configObj.list.length;a++)if(this.configObj.list[a].model.includes("select")){var s=this.configObj.list[a].options.options.map(function(t){return t.value});if(this.configObj.list[a].options.multiple){if(this.configObj.list[a].options.defaultValue.length||!s.includes(this.configObj.list[a].options.defaultValue[0])){n=!1,i=this.configObj.list[a].name;break}}else if(""!==this.configObj.list[a].options.defaultValue&&!s.includes(this.configObj.list[a].options.defaultValue)){n=!1,i=this.configObj.list[a].name;break}}if(!n)return void this.$message.warning('"'.concat(i,'"该项的默认值与选项不匹配，请删除该项重试'));this.listTableData=[],this.configObj.list.forEach(function(e){e.hasOwnProperty("isInList")||Object.assign(e,{isInList:!1}),e.hasOwnProperty("isSearch")||Object.assign(e,{isSearch:!1}),e.hasOwnProperty("sort")||Object.assign(e,{sort:""}),t.listTableData.push(e)}),this.currentIndex=2}else this.$message.warning("表单字段不可为空")},changeTableShow:function(t){var e=this;this.tableLoading=!0,t.isInList=!t.isInList,t.isInList||(t.isSearch=!1),setTimeout(function(){e.tableLoading=!1},16)},changeTableSearch:function(t){var e=this;if(this.tableLoading=!0,!t.isInList)return t.isSearch=!1,this.$message.warning("只有在列表中显示的字段才能被搜索"),void(this.tableLoading=!1);t.isSearch=!t.isSearch,setTimeout(function(){e.tableLoading=!1},100)},listTableSortChange:function(t,e){var n=Number(t.target.value);isNaN(n)?this.$message.error("排序请输入数字"):e.sort=n},submitAllForm:function(){var t=this;this.$confirm("确定要发布吗？","提示",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning"}).then(function(){t.submitLoading=!0;var e=[];if(t.listTableData.forEach(function(t){t.isInList&&e.push(t)}),!e.length)return t.$message.warning("请至少选择一个或以上字段作为列表展示字段"),void(t.submitLoading=!1);t.configObj.list=JSON.parse(JSON.stringify(t.listTableData));var n={title:t.baseInfo.title,status:!0===t.baseInfo.status?1:2,form_config:JSON.stringify(t.configObj),list_config:JSON.stringify(e),menuid:2,mid:t.baseInfo.mid,id:"edit"===t.pageType?t.$route.params.id:0};Object(s["a"])(n).then(function(e){t.submitLoading=!1,t.$router.push("/designCenter/form-design/list")}).catch(function(e){console.log(e),t.submitLoading=!1})}).catch(function(){console.log("cancel")})},toPrev:function(t){this.currentIndex=t},handleModalOk:function(){this.$router.push("/designCenter/form-design/list")}}},l=c,u=(n("3cae"),n("2877")),d=Object(u["a"])(l,i,a,!1,null,"18cfd406",null);e["default"]=d.exports},"889e":function(t,e,n){"use strict";var i=n("88a8"),a=n.n(i);a.a},"88a8":function(t,e,n){},a336:function(t,e,n){},a49e:function(t,e,n){"use strict";n.d(e,"f",function(){return a}),n.d(e,"h",function(){return r}),n.d(e,"b",function(){return c}),n.d(e,"a",function(){return u}),n.d(e,"e",function(){return s}),n.d(e,"d",function(){return o}),n.d(e,"g",function(){return d}),n.d(e,"c",function(){return l});var i=n("b775"),a=function(t){return Object(i["b"])({url:"api/forms/listData",method:"post",data:t})},s=function(t){return Object(i["b"])({url:"api/forms/quickEditData",method:"post",data:t})},o=function(t){return Object(i["b"])({url:"api/forms/delData",method:"post",data:t})},r=function(t){return Object(i["b"])({url:"admin/Devmenu/listData",method:"post",data:t})},c=function(t){return Object(i["b"])({url:"api/Sys/checkField",method:"post",data:t})},l=function(t){return Object(i["b"])({url:"api/forms/checkStatus",method:"post",data:t})},u=function(t){return Object(i["b"])({url:"api/forms/saveData",method:"post",data:t})},d=function(t){return Object(i["b"])({url:"api/forms/detailData",method:"post",data:t})}},e2a5:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tree"},[n("a-popover",{attrs:{placement:"rightTop",overlayClassName:"tree-popover"},on:{visibleChange:t.visibleChange}},[n("template",{slot:"content"},[t.treeData.length?t._e():n("div",{staticClass:"no-data"},[t._v("暂无数据")]),n("TreeNode",{attrs:{treeData:t.treeData,nodeLevel:t.nodeLevel,activeNodeId:t.activeNodeId},on:{nodeClick:t.nodeClick}})],1),n("a-input",{attrs:{placeholder:t.placeholderInner,readOnly:!0,value:t.title},on:{change:t.handleChange}},[n("a-icon",{style:{color:"#999"},attrs:{slot:"suffix",type:t.down?"down":"up"},slot:"suffix"})],1)],2)],1)},a=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tree"},t._l(t.treeData,function(e,i){return n("div",{key:e.id},[n("div",{staticClass:"tree-item",class:{active:e.id==t.activeNodeId},style:t.style,attrs:{href:"javascript:;"},on:{click:function(n){return t.nodeClick(e)}}},[e.children?n("a-icon",{attrs:{type:t.openNode[i]?"caret-up":"caret-down"},on:{click:function(e){return e.stopPropagation(),t.visChildren(i)}}}):t._e(),t._v("\n            "+t._s(e.title)+"\n        ")],1),n("div",{directives:[{name:"show",rawName:"v-show",value:t.openNode[i],expression:"openNode[index]"}]},[e.children&&e.children.length?n("TreeNode",{attrs:{treeData:e.children,nodeLevel:t.nodeLevel+1,activeNodeId:t.activeNodeId},on:{nodeClick:t.nodeClick}}):t._e()],1)])}),0)},o=[],r=(n("6c7b"),{name:"TreeNode",props:["treeData","nodeLevel","activeNodeId"],data:function(){return{openNode:[]}},computed:{style:function(){return{paddingLeft:20*this.nodeLevel+"px"}}},watch:{treeData:{handler:function(){var t=new Array(this.treeData.length).fill(!0);this.$set(this,"openNode",t)},deep:!0}},mounted:function(){var t=new Array(this.treeData.length).fill(!0);this.$set(this,"openNode",t)},methods:{visChildren:function(t){var e=this.openNode[t];this.$set(this.openNode,t,!e)},nodeClick:function(t){this.$emit("nodeClick",t)}}}),c=r,l=(n("e898"),n("2877")),u=Object(l["a"])(c,s,o,!1,null,"15b7a835",null),d=u.exports,f={name:"MenuTree",components:{TreeNode:d},props:["treeData","nodeLevel","nodeInfo","placeholder"],data:function(){var t=this.nodeInfo;return{down:!1,title:t.title,activeNodeId:t.id}},computed:{placeholderInner:function(){return this.placeholder?this.placeholder:"请选择上级菜单"}},watch:{nodeInfo:function(t){this.title=t.title,this.activeNodeId=t.id,this.triggerChange(t.id)}},mounted:function(){this.title=this.nodeInfo.title,this.activeNodeId=this.nodeInfo.id},methods:{nodeClick:function(t){this.$emit("nodeClick",t)},visibleChange:function(t){this.down=!t,this.$emit("visibleHandle",t)},handleChange:function(t){this.triggerChange(this.nodeInfo.id)},triggerChange:function(t){this.$emit("change",t)}}},h=f,m=(n("889e"),n("2d75"),Object(l["a"])(h,i,a,!1,null,"a1e2e332",null));e["a"]=m.exports},e898:function(t,e,n){"use strict";var i=n("3e88"),a=n.n(i);a.a}}]);