(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["FormItem"],{"4c36":function(e,t,a){},a428:function(e,t,a){"use strict";var n=a("4c36"),i=a.n(n);i.a},e6f5:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-spin",{attrs:{spinning:e.pageLoading}},[a("a-card",{attrs:{bordered:!1}},[a("h5",{staticClass:"page-title"},[e._v(e._s(e.pageTitle))]),a("fm-generate-form",{ref:"generateForm",attrs:{readOnly:e.readOnly,data:e.jsonData,formId:e.formId,linkageArr:e.linkageArr,signatureRes:e.signatureRes}}),a("div",{staticClass:"bottom-btn"},["check"!==e.pageType?a("a-button",{staticClass:"mr20 wide-btn",attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")]):e._e(),a("a-button",{staticClass:"wide-btn",on:{click:e.back}},[e._v("返回")])],1)],1)],1)],1)},i=[],o=(a("6762"),a("2fdb"),a("28a5"),a("4f7f"),a("5df3"),a("1c4c"),a("c5f6"),a("7f7f"),a("ac6a"),a("456d"),a("ef5a")),s=a("ca00");function r(e,t,a){var n;"undefined"===typeof WebSocket?console.log("您的浏览器不支持WebSocket"):(console.log("您的浏览器支持WebSocket"),n=new WebSocket(e),n.onopen=function(){console.log("Socket 已打开"),n.send(t)},n.onmessage=function(e){a(e,n)},n.onclose=function(){console.log("Socket已关闭")},n.onerror=function(){console.log("Socket发生了错误,请刷新页面")})}var c={name:"handleFormItem",data:function(){return{menuid:0,pageType:"",pageTitle:"",pageLoading:!1,readOnly:!1,jsonData:{},formId:"",linkageArr:[],wsObj:{},signatureRes:{}}},created:function(){this.initPage(),this.initSocketData()},beforeDestroy:function(){this.wsObj&&Object.keys(this.wsObj).length&&this.wsObj.close()},methods:{initPage:function(){switch(this.$route.name){case"addBaseFormItem":case"addBaseFormItemCard":this.pageType="add",this.pageTitle="新建",this.readOnly=!1,this.getPageConfig();break;case"editBaseFormItem":case"editBaseFormItemCard":this.pageType="edit",this.pageTitle="编辑",this.readOnly=!1,this.getPageConfig();break;case"checkBaseFormItem":case"checkBaseFormItemCard":this.pageType="check",this.pageTitle="查看",this.readOnly=!0,this.getPageConfig();break}},getPageConfig:function(){var e=this;this.menuid=Number(this.$route.params.menuid),this.pageLoading=!0;var t={menuid:this.menuid,id:0};"add"!==this.pageType&&(t.id=Number(this.$route.params.id)),Object(o["c"])(t).then(function(t){e.jsonData=JSON.parse(t.Data.formInfo);var a=t.Data.dataInfo?JSON.parse(t.Data.dataInfo):"";if(e.formId=t.Data.formId,t.Data.linkageInfo){var n=JSON.parse(t.Data.linkageInfo),i=[];Object.keys(n).forEach(function(e){i.push(n[e].field1)}),e.linkageArr=Array.from(new Set(i))}""!==a?(e.jsonData.list&&e.jsonData.list.length&&e.jsonData.list.forEach(function(e){for(var t=0,n=Object.keys(a);t<n.length;t++){var i=n[t];if(e.model===i){"imgupload"===e.model.split("_")[0]?e.options.defaultValue=a[i]:"checkbox"===e.model.split("_")[0]||e.options.multiple?e.options.defaultValue=a[i].split(","):e.options.defaultValue=a[i];break}}}),e.pageLoading=!1):e.pageLoading=!1}).catch(function(t){console.log(t),e.pageLoading=!1})},submit:function(){var e=this;this.$refs.generateForm.getData().then(function(t){for(var a=!0,n=0,i=Object.keys(t);n<i.length;n++)for(var s=i[n],r=0;r<e.jsonData.list.length;r++){if(s.includes("imgupload")&&s===e.jsonData.list[r].model&&t[s].length<e.jsonData.list[r].options.min){e.$message.warning("“".concat(e.jsonData.list[r].name,"”项需要至少上传").concat(e.jsonData.list[r].options.min,"张图片")),a=!1;break}if(s.includes("signature")&&s===e.jsonData.list[r].model&&e.jsonData.list[r].options.required&&!e.jsonData.list[r].options.defaultValue.length){e.$message.warning("“".concat(e.jsonData.list[r].name,"”项不能为空")),a=!1;break}}if(a){var c=JSON.parse(JSON.stringify(t));Object.keys(c).forEach(function(e){if("checkbox"===e.split("_")[0]&&(c[e]=c[e].join()),"select"===e.split("_")[0]&&Array.isArray(c[e])&&(c[e]=c[e].join()),"imgupload"===e.split("_")[0]){var t=[];c[e].forEach(function(e){t.push(e.id)}),c[e]=t.join()}}),e.pageLoading=!0,"add"===e.pageType?Object.assign(c,{id:0}):"edit"===e.pageType&&Object.assign(c,{id:Number(e.$route.params.id)});var l={menuid:e.menuid,formData:JSON.stringify(c)};Object(o["h"])(l).then(function(t){e.pageLoading=!1,e.$router.go(-1)}).catch(function(t){console.log(t),e.pageLoading=!1})}}).catch(function(e){console.log(e)})},back:function(){this.$router.go(-1)},initSocketData:function(){if(!this.$route.path.includes("check")){var e="";e=location.hostname;var t=Object(s["a"])({socketUrl:"api/socket/index"}),a=this;r("ws://".concat(e,":8080"),JSON.stringify(t),function(e,t){if(e.data)try{var n=JSON.parse(e.data);a.jsonData.list&&a.jsonData.list.length&&"signature"===n.socketType&&(a.signatureRes=n.socketData)}catch(i){console.log(i)}a.wsObj=t})}}}},l=c,g=(a("a428"),a("2877")),d=Object(g["a"])(l,n,i,!1,null,"75c93e0a",null);t["default"]=d.exports}}]);