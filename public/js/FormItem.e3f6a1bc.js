(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["FormItem"],{"4d5a":function(t,a,e){"use strict";var n=e("7048"),o=e.n(n);o.a},7048:function(t,a,e){},e6f5:function(t,a,e){"use strict";e.r(a);var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("a-spin",{attrs:{spinning:t.pageLoading}},[e("a-card",{attrs:{bordered:!1}},[e("h5",{staticClass:"page-title"},[t._v(t._s(t.pageTitle))]),e("fm-generate-form",{ref:"generateForm",attrs:{readOnly:t.readOnly,data:t.jsonData,formId:t.formId,linkageArr:t.linkageArr}}),e("div",{staticClass:"bottom-btn"},["check"!==t.pageType?e("a-button",{staticClass:"mr20 wide-btn",attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交")]):t._e(),e("a-button",{staticClass:"wide-btn",on:{click:t.back}},[t._v("返回")])],1)],1)],1)],1)},o=[],i=(e("6762"),e("2fdb"),e("28a5"),e("4f7f"),e("5df3"),e("1c4c"),e("c5f6"),e("7f7f"),e("ac6a"),e("456d"),e("ef5a")),s=e("ca00");function r(t,a,e){var n;"undefined"===typeof WebSocket?console.log("您的浏览器不支持WebSocket"):(console.log("您的浏览器支持WebSocket"),n=new WebSocket(t),n.onopen=function(){console.log("Socket 已打开"),n.send(a)},n.onmessage=function(t){e(t,n)},n.onclose=function(){console.log("Socket已关闭")},n.onerror=function(){console.log("Socket发生了错误,请刷新页面")})}var c={name:"handleFormItem",data:function(){return{menuid:0,pageType:"",pageTitle:"",pageLoading:!1,readOnly:!1,jsonData:{},formId:"",linkageArr:[],wsObj:{}}},created:function(){this.initPage(),this.initSocketData()},beforeDestroy:function(){this.wsObj&&Object.keys(this.wsObj).length&&this.wsObj.close()},methods:{initPage:function(){switch(this.$route.name){case"addBaseFormItem":case"addBaseFormItemCard":this.pageType="add",this.pageTitle="新建",this.readOnly=!1,this.getPageConfig();break;case"editBaseFormItem":case"editBaseFormItemCard":this.pageType="edit",this.pageTitle="编辑",this.readOnly=!1,this.getPageConfig();break;case"checkBaseFormItem":case"checkBaseFormItemCard":this.pageType="check",this.pageTitle="查看",this.readOnly=!0,this.getPageConfig();break}},getPageConfig:function(){var t=this;this.menuid=Number(this.$route.params.menuid),this.pageLoading=!0;var a={menuid:this.menuid,id:0};"add"!==this.pageType&&(a.id=Number(this.$route.params.id)),Object(i["c"])(a).then(function(a){t.jsonData=JSON.parse(a.Data.formInfo);var e=a.Data.dataInfo?JSON.parse(a.Data.dataInfo):"";if(t.formId=a.Data.formId,a.Data.linkageInfo){var n=JSON.parse(a.Data.linkageInfo),o=[];Object.keys(n).forEach(function(t){o.push(n[t].field1)}),t.linkageArr=Array.from(new Set(o))}""!==e?(t.jsonData.list&&t.jsonData.list.length&&t.jsonData.list.forEach(function(t){for(var a=0,n=Object.keys(e);a<n.length;a++){var o=n[a];if(t.model===o){"imgupload"===t.model.split("_")[0]?t.options.defaultValue=e[o]:"checkbox"===t.model.split("_")[0]||t.options.multiple?t.options.defaultValue=e[o].split(","):t.options.defaultValue=e[o];break}}}),t.pageLoading=!1):t.pageLoading=!1}).catch(function(a){console.log(a),t.pageLoading=!1})},submit:function(){var t=this;this.$refs.generateForm.getData().then(function(a){for(var e=!0,n=0,o=Object.keys(a);n<o.length;n++)for(var s=o[n],r=0;r<t.jsonData.list.length;r++){if(s.includes("imgupload")&&s===t.jsonData.list[r].model&&a[s].length<t.jsonData.list[r].options.min){t.$message.warning("“".concat(t.jsonData.list[r].name,"”项需要至少上传").concat(t.jsonData.list[r].options.min,"张图片")),e=!1;break}if(s.includes("signature")&&s===t.jsonData.list[r].model&&t.jsonData.list[r].options.required&&!t.jsonData.list[r].options.defaultValue.length){t.$message.warning("“".concat(t.jsonData.list[r].name,"”项不能为空")),e=!1;break}}if(e){var c=JSON.parse(JSON.stringify(a));Object.keys(c).forEach(function(t){if("checkbox"===t.split("_")[0]&&(c[t]=c[t].join()),"select"===t.split("_")[0]&&Array.isArray(c[t])&&(c[t]=c[t].join()),"imgupload"===t.split("_")[0]){var a=[];c[t].forEach(function(t){a.push(t.id)}),c[t]=a.join()}}),t.pageLoading=!0,"add"===t.pageType?Object.assign(c,{id:0}):"edit"===t.pageType&&Object.assign(c,{id:Number(t.$route.params.id)});var l={menuid:t.menuid,formData:JSON.stringify(c)};Object(i["h"])(l).then(function(a){t.pageLoading=!1,t.$router.go(-1)}).catch(function(a){console.log(a),t.pageLoading=!1})}}).catch(function(t){console.log(t)})},back:function(){this.$router.go(-1)},initSocketData:function(){if(!this.$route.path.includes("check")){var t="";t=location.hostname;var a=Object(s["a"])({socketUrl:"api/socket/index"}),e=this;r("ws://".concat(t,":8080"),JSON.stringify(a),function(t,a){if(t.data)try{var n=JSON.parse(t.data);e.jsonData.list&&e.jsonData.list.length&&e.jsonData.list.forEach(function(t){if("signature"===n.socketType&&t.model===n.socketData.field){var a={id:n.socketData.id,url:n.socketData.url};t.options.defaultValue=[a]}})}catch(o){console.log(o)}e.wsObj=a})}}}},l=c,d=(e("4d5a"),e("2877")),f=Object(d["a"])(l,n,o,!1,null,"6674d514",null);a["default"]=f.exports}}]);